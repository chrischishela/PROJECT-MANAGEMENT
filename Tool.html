<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool Management System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f6f9;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: #fff;
            font-weight: bold;
        }
        td {
            background-color: #f9f9f9;
        }
        .toolbar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            align-items: center;
        }
        .search-input {
            padding: 8px;
            width: 300px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .toolbar button {
            padding: 10px 20px;
            font-size: 14px;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .add-tool {
            background-color: #28a745;
        }
        .assign-tool {
            background-color: #007bff;
        }
        .add-tool:hover {
            background-color: #218838;
        }
        .assign-tool:hover {
            background-color: #0056b3;
        }
        .form-container {
            display: none;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-top: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-container h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #333;
        }
        .form-container label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        .form-container input, .form-container select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-container button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .form-container button:hover {
            background-color: #0056b3;
        }
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        .pagination button {
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .pagination button:hover {
            background-color: #2980b9;
        }
        .pagination span {
            font-size: 14px;
        }
    </style>
    <!-- Add Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, update } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCFGX-J09YjbCe_u58yexo7Eg6VqWwPje0",
            authDomain: "project-management-a1c5e.firebaseapp.com",
            databaseURL: "https://project-management-a1c5e-default-rtdb.firebaseio.com/",
            projectId: "project-management-a1c5e",
            storageBucket: "project-management-a1c5e.appspot.com",
            messagingSenderId: "662718236281",
            appId: "1:662718236281:web:e859b39671aefa67e436a8",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Get DOM elements
        const toolTable = document.getElementById('toolTable').getElementsByTagName('tbody')[0];
        const searchInput = document.querySelector('.search-input');
        const assignForm = document.getElementById('assignForm');
        const assignToolForm = document.getElementById('assignToolForm');
        const pagination = document.querySelector('.pagination');
        const pageInfo = document.getElementById('pageInfo');

        let tools = [];
        let currentPage = 1;
        const rowsPerPage = 10;

        // Load tools from Firebase
        function loadTools() {
            const toolsRef = ref(db, 'tools/');
            onValue(toolsRef, (snapshot) => {
                const data = snapshot.val();
                tools = data ? Object.values(data) : [];
                updateTable();
                updatePagination();
            });
        }

        // Save tool assignment to Firebase
        function saveToolAssignment(tool) {
            const toolsRef = ref(db, 'tools/');
            const newToolRef = push(toolsRef);
            set(newToolRef, tool).then(() => {
                console.log("Tool assignment saved to Firebase:", tool);
            }).catch((error) => {
                console.error("Error saving tool assignment to Firebase:", error);
            });
        }

        // Update tool assignment in Firebase
        function updateToolAssignment(tool, toolKey) {
            const toolRef = ref(db, `tools/${toolKey}`);
            update(toolRef, tool).then(() => {
                console.log("Tool assignment updated in Firebase:", tool);
            }).catch((error) => {
                console.error("Error updating tool assignment in Firebase:", error);
            });
        }

        // Filter table based on search input
        function filterTable() {
            const filter = searchInput.value.toLowerCase();
            const rows = toolTable.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let match = false;

                for (let j = 0; j < cells.length; j++) {
                    if (cells[j].textContent.toLowerCase().includes(filter)) {
                        match = true;
                        break;
                    }
                }

                rows[i].style.display = match ? '' : 'none';
            }
        }

        // Show or hide the assignment form
        function showForm() {
            assignForm.style.display = assignForm.style.display === 'block' ? 'none' : 'block';
        }

        // Handle tool assignment form submission
        function assignTool(event) {
            event.preventDefault();

            const employeeName = document.getElementById('employeeName').value;
            const projectName = document.getElementById('projectName').value;
            const toolName = document.getElementById('toolName').value;
            const assignedDate = new Date().toLocaleDateString();

            const tool = {
                toolName,
                currentHolder: employeeName,
                currentLocation: projectName,
                assignedDate
            };

            saveToolAssignment(tool);
            showForm();
        }

        // Update the tool table
        function updateTable() {
            toolTable.innerHTML = ''; // Clear the table

            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedTools = tools.slice(start, end);

            paginatedTools.forEach((tool, index) => {
                const row = toolTable.insertRow();
                row.insertCell(0).innerText = start + index + 1;
                row.insertCell(1).innerText = tool.toolName;
                row.insertCell(2).innerText = tool.currentHolder;
                row.insertCell(3).innerText = tool.currentLocation;
                row.insertCell(4).innerText = tool.assignedDate;
            });
        }

        // Update pagination controls
        function updatePagination() {
            const totalPages = Math.ceil(tools.length / rowsPerPage);
            pageInfo.innerText = `Page ${currentPage} of ${totalPages}`;

            if (currentPage > 1) {
                pagination.querySelector('button[onclick="previousPage()"]').disabled = false;
            } else {
                pagination.querySelector('button[onclick="previousPage()"]').disabled = true;
            }

            if (currentPage < totalPages) {
                pagination.querySelector('button[onclick="nextPage()"]').disabled = false;
            } else {
                pagination.querySelector('button[onclick="nextPage()"]').disabled = true;
            }
        }

        // Go to the previous page
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateTable();
                updatePagination();
            }
        }

        // Go to the next page
        function nextPage() {
            const totalPages = Math.ceil(tools.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateTable();
                updatePagination();
            }
        }

        // Event listeners
        searchInput.addEventListener('input', filterTable);
        assignToolForm.addEventListener('submit', assignTool);

        // Initial load of tools from Firebase
        loadTools();
    </script>
</head>
<body>

    <h1>Tool Management System</h1>

    <div class="toolbar">
        <input type="text" class="search-input" placeholder="Search tools..." oninput="filterTable()">
        <button class="add-tool">View history</button>
        <button class="assign-tool" onclick="showForm()">Assign Tool</button>
    </div>

    <div class="form-container" id="assignForm">
        <h2>Assign Tool</h2>
        <form id="assignToolForm">
            <label for="employeeName">Employee Name:</label>
            <select id="employeeName" name="employeeName" required>
                <option value="Brighton Matolokosh">Brighton Matolokosh</option>
                <option value="Caphas Tembo">Caphas Tembo</option>
            </select>

            <label for="projectName">Project Name:</label>
            <select id="projectName" name="projectName" required>
                <option value="Hazida Limited">Hazida Limited</option>
                <option value="Hazida Motors">Hazida Motors</option>
            </select>

            <label for="toolName">Tool Name:</label>
            <select id="toolName" name="toolName" required>
                <option value="GRINDER">GRINDER</option>
                <option value="WELDING SQUARE">WELDING SQUARE</option>
                <option value="COMBINATION SQUARE">COMBINATION SQUARE</option>
                <option value="WELDING SHIELD">WELDING SHIELD</option>
                <option value="HAND SAW">HAND SAW</option>
                <option value="SANDING MACHINE">SANDING MACHINE</option>
                <option value="STAPLE GUN">STAPLE GUN</option>
                <option value="TENAN SAW">TENAN SAW</option>
                <option value="CIRCULAR SAW">CIRCULAR SAW</option>
                <option value="JIK SAW">JIK SAW</option>
                <option value="MEASURING TAPE">MEASURING TAPE</option>
                <option value="PLANE">PLANE</option>
                <option value="CROW BAR">CROW BAR</option>
                <option value="BABY GRINDER">BABY GRINDER</option>
            </select>

            <button type="submit">Submit Assignment</button>
        </form>
    </div>

    <table id="toolTable">
        <thead>
            <tr>
                <th>Bin ID</th>
                <th>Tool Name</th>
                <th>Current Holder</th>
                <th>Current Location</th>
                <th>Assigned Date</th>
            </tr>
        </thead>
        <tbody>
            <!-- Tool rows will be dynamically added here -->
        </tbody>
    </table>

    <div class="pagination">
        <button onclick="previousPage()">Previous</button>
        <span id="pageInfo">Page 1 of 1</span>
        <button onclick="nextPage()">Next</button>
    </div>

</body>
</html>
